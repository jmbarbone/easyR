---
title: "Working with `facts`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Working with `facts`}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

bench_mark <- function(x) {
  b <- bench::mark(fact(x), factor(x), forcats::as_factor(x), iterations = 50, check = FALSE)
  print(ggplot2::autoplot(b) + ggplot2::labs(title = class(x)))
  b
}
```

```{r setup}
library(mark)
```

`fact`s are a special class much like `factors` but with some performance improvements.

| Case    | `factor()` | `fact()` |
| ------- | ---------- | -------- |
| Level sorting | When not set, sorts | Sorts numbers, preset sorting for logical, no sorting for character |
| `NA` | Default levels don't include `NA` | When `NA` is present, is added as the last level |
| S3 methods | None | S3 methods can extend functionality |
| Attributes | `levels`, `class`|  `levels`, `a`, `uniques`, `na`, `class` |

```{r}
x <- apply(matrix(sample(letters, 1e5, TRUE), ncol = 4), 1, collapse0)
bench_mark(x)

x <- round(runif(1e5), 2)
bench_mark(x)

x <- order(x)
bench_mark(x)

x <- x > 1e5 / 2
x[sample(x, 1e3)] <- NA
bench_mark(x)
```

`fact()` takes an S3 approach for factors which allows data to take different sorting and matching processes.
This allows `fact()` to be most efficient with its labeling and transformations.
This differs from `factor()` which uses the same process, and always sorts labels in ascending order.

```{r}
utils::methods("fact")
```
